function rand(a,b){var c=Math.floor(Math.random()*(b-a+1))+a;while(c<a)c=Math.floor(Math.random()*(b-a+1))+a;return c}function handleColor(a){switch(a){case 0:return ctx.fillStyle="transparent";case 1:return ctx.fillStyle="#87dcec";case 2:return ctx.fillStyle="#72d856";case 3:return ctx.fillStyle="#f7e818";case 4:return ctx.fillStyle="#f75149";case 5:return ctx.fillStyle="#303030";case 6:return ctx.fillStyle="#fff1da";case 7:return ctx.fillStyle="#75430a";case 8:return ctx.fillStyle=rand(0,4)?"#0e7259":"#217017"}}function handleInfo(){var a=5;for(var b=0;b<hero.life;b++){for(var c=0;c<sprites.hero.right.length;c++)for(var d=0;d<sprites.hero.right[c].length;d++)handleColor(sprites.hero.right[c][d]),ctx.fillRect(d*2+a,c*2+5,2,2);a+=sprites.hero.left[0].length*2.5}ctx.font="30px Visitor",ctx.textAlign="right",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText("You've killed "+score+" enemies",cWidth-5,28),ctx.font="25px Visitor"}function handleDeath(){var a="You are dead!",a=a.split(" "),b=30,c=30,d=10;for(var e in a)ctx.font=b+"px Visitor",ctx.textAlign="center",ctx.fillStyle="rgb(255, 255, 255)",ctx.fillText(a[e],cWidth/2,(cHeight-50)/2+d),b+=5,d+=c,c+=10}function enemy(){this.x=rand(0,1)?0:cWidth,this.hit=0,this.species=rand(0,2);switch(this.species){case 0:this.species="zombie",this.life=2,this.speed=rand(1,4);break;case 1:this.species="blob",this.life=0,this.speed=rand(1,3);break;case 2:this.species="muzz",this.life=0,this.speed=rand(3,5)}this.species!="muzz"?this.y=cHeight-(sprites.enemy[this.species].left.length*scale+scale*2):this.y=rand(20,cHeight-(sprites.enemy.zombie.left.length*scale+scale*5)),this.dx=hero.x}function bullet(){this.x=hero.dir=="left"?hero.x:hero.x+scale*10,this.y=hero.crouch?hero.y+scale*7:hero.y+scale*6,this.state=1,this.dir=0}function cloud(){this.x=rand(0,1)?-(sprites.cloud.length*scale):cWidth,this.y=rand(0,200),this.x>0?this.dir="left":this.dir="right",this.speed=rand(1,2)}function doKeys(){document.onkeydown=function(a){switch(a.keyCode){case 38:case 87:hero.jump=1,a.preventDefault();break;case 32:a.preventDefault();break;case 40:case 83:hero.crouch=1,hero.y>=cHeight-(sprites.hero.left.length*scale+scale*2)&&(hero.y=cHeight-(sprites.hero.crouch.left.length*scale+scale*2)),a.preventDefault();break;case 37:case 65:hero.speed=hero.x<=0?0:-scale,a.preventDefault();break;case 39:case 68:hero.speed=hero.x>=cWidth-(sprites.hero.left.length-1)*scale?0:scale,a.preventDefault()}},document.onkeyup=function(a){switch(a.keyCode){case 38:case 87:hero.jump=0,a.preventDefault();break;case 32:bullets.length<11?bullets.push(new bullet):"";break;case 40:case 83:hero.crouch=0,hero.y=cHeight-(sprites.hero.left.length*scale+scale*2),a.preventDefault();break;case 37:case 65:hero.speed=0,a.preventDefault();break;case 39:case 68:hero.speed=0,a.preventDefault()}}}function drawHero(){hero.speed!=0&&(hero.dir=hero.speed>0?"right":"left",hero.x=hero.speed>0?hero.x+scale:hero.x-scale),hero.jump!=0?(hero.y=hero.y-scale*4,hero.jump=0):!hero.jump&&hero.y<cHeight-(sprites.hero.left.length*scale+scale*2)&&(hero.y=hero.y+scale);for(var a in enemys){var b=enemys[a];hero.y<=b.y&&hero.y>=b.y-scale*12&&(b.x>hero.x&&b.x<hero.x+scale*10||b.x+scale*9>hero.x&&b.x+scale*9<hero.x+scale*sprites.hero[hero.dir][0].length)&&(hero.life--,hero.hit=1,enemys.splice(a,1),spawnChange++)}if(hero.life>0)if(!hero.crouch)for(var c=0;c<sprites.hero[hero.dir].length;c++)for(var d=0;d<sprites.hero[hero.dir][c].length;d++)handleColor(hero.hit?sprites.hero[hero.dir][c][d]?4:0:sprites.hero[hero.dir][c][d]),ctx.fillRect(d*scale+hero.x,c*scale+hero.y,scale,scale);else for(var c=0;c<sprites.hero.crouch[hero.dir].length;c++)for(var d=0;d<sprites.hero.crouch[hero.dir][c].length;d++)handleColor(hero.hit?sprites.hero.crouch[hero.dir][c][d]?4:0:sprites.hero.crouch[hero.dir][c][d]),ctx.fillRect(d*scale+hero.x,c*scale+hero.y,scale,scale);else handleDeath();hero.hit&&(hero.hit=0)}function drawEnemy(){for(var a in enemys){e=enemys[a],dir=e.x<e.dx?"right":"left",e.dx=hero.x,e.x<e.dx?e.x=e.x+e.speed:e.x>e.dx&&(e.x=e.x-e.speed);if(e.species!="muzz"){for(var b in bullets){var c=bullets[b];c.x<e.x+scale*9&&c.x>e.x&&c.y<e.y+sprites.enemy[e.species][dir].length*scale&&c.y>e.y&&(bullets.splice(b,1),e.hit=1,e.life>0?e.life--:(enemys.splice(a,1),score++,spawnChange>0&&spawnChange--))}for(var d=0;d<sprites.enemy[e.species][dir].length;d++)for(var f=0;f<sprites.enemy[e.species][dir][d].length;f++)handleColor(e.hit?sprites.enemy[e.species][dir][d][f]?4:0:sprites.enemy[e.species][dir][d][f]),ctx.fillRect(f*scale+e.x,d*scale+e.y,scale,scale)}else{for(var b in bullets){var c=bullets[b];c.x<e.x+scale*9&&c.x>e.x&&c.y<e.y+sprites.enemy[e.species].length*scale&&c.y>e.y&&(bullets.splice(b,1),e.hit=1,e.life>0?e.life--:(enemys.splice(a,1),score++,spawnChange>0&&spawnChange--))}hero.y<e.y?e.y--:e.y++;for(var d=0;d<sprites.enemy.muzz.length;d++)for(var f=0;f<sprites.enemy.muzz[d].length;f++)handleColor(e.hit?sprites.enemy.muzz[d][f]?4:0:sprites.enemy.muzz[d][f]),ctx.fillRect(f*scale+e.x,d*scale+e.y,scale,scale)}e.hit&&(e.hit=0)}}function drawBullet(){for(var a in bullets){var b=bullets[a];for(var c=0;c<sprites.bullet.bullet.length;c++)handleColor(5),ctx.fillRect(c*scale+b.x,b.y,scale,scale);b.dir||(hero.dir=="right"?b.x<cWidth?(b.x=b.x+scale*2,b.dir=hero.dir):bullets.splice(a,1):hero.dir=="left"&&(b.x>0?(b.x=b.x-scale*2,b.dir=hero.dir):bullets.splice(a,1))),b.dir=="right"?b.x<cWidth?b.x=b.x+scale*2:bullets.splice(a,1):b.dir=="left"&&(b.x>0?b.x=b.x-scale*2:bullets.splice(a,1))}}function drawClouds(){for(var a in clouds){var b=clouds[a];b.dir=="left"?(b.x<0&&clouds.splice(a,1),b.x=b.x-b.speed):(b.x>cWidth+sprites.cloud.length*scale&&clouds.splice(a,1),b.x=b.x+b.speed);for(var c=0;c<sprites.cloud.length;c++)for(var d=0;d<sprites.cloud[c].length;d++)handleColor(sprites.cloud[c][d]),ctx.fillRect(d*scale+b.x,c*scale+b.y,scale,scale)}}function loop(){ctx.clearRect(0,0,cWidth,cHeight),handleColor(1),ctx.fillRect(0,0,cWidth,cHeight),handleColor(2),ctx.fillRect(0,cHeight-scale*2,cWidth,cHeight),doKeys(),drawBullet(),drawHero(),drawClouds(),handleInfo(),drawEnemy()}var canvas=document.getElementById("game");canvas.width=document.width,canvas.height=document.height;var ctx=canvas.getContext("2d"),cWidth=canvas.width,cHeight=canvas.height,scale=8,dir,score=0,spawnChange=10;enemys=[],bullets=[],clouds=[],sprites={hero:{left:[[0,0,0,4,4,4,4,0,0,0],[0,0,4,4,4,4,4,4,4,0],[0,0,6,5,6,6,6,6,0,0],[0,0,6,6,6,6,6,6,0,0],[0,0,4,4,6,6,6,6,0,0],[0,0,0,7,7,7,7,0,0,0],[3,3,0,5,5,5,5,7,0,7],[0,6,5,5,5,5,5,0,7,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,0,0,5,0,0,0],[0,0,4,4,0,4,4,0,0,0]],right:[[0,0,0,4,4,4,4,0,0,0],[0,4,4,4,4,4,4,4,0,0],[0,0,6,6,6,6,5,6,0,0],[0,0,6,6,6,6,6,6,0,0],[0,0,6,6,6,6,4,4,0,0],[0,7,0,7,7,7,7,0,0,0],[7,0,7,5,5,5,5,0,3,3],[0,0,0,5,5,5,5,5,6,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,5,5,5,0,0,0],[0,0,0,5,0,0,5,0,0,0],[0,0,0,4,4,0,4,4,0,0]],jump:{left:[],right:[]},crouch:{left:[[0,0,0,4,4,4,4,0,0,0],[0,0,4,4,4,4,4,4,4,0],[0,0,6,5,6,6,6,6,0,0],[0,0,6,6,6,6,6,6,0,7],[0,0,4,6,6,6,6,7,7,0],[0,0,0,7,7,7,7,0,0,0],[0,6,5,5,5,5,5,0,0,0],[3,3,0,5,5,5,5,0,0,0],[0,0,0,5,0,0,5,0,0,0],[0,0,4,4,0,4,4,0,0,0]],right:[[0,0,0,4,4,4,4,0,0,0],[0,4,4,4,4,4,4,4,0,0],[0,0,6,6,6,6,5,6,0,0],[7,0,6,6,6,6,6,6,0,0],[0,7,7,6,6,6,6,4,0,0],[0,0,0,7,7,7,7,0,0,0],[0,0,0,5,5,5,5,5,6,0],[0,0,0,5,5,5,5,0,3,3],[0,0,0,5,0,0,5,0,0,0],[0,0,0,4,4,0,4,4,0,0]]}},enemy:{zombie:{left:[[0,0,0,0,8,8,8,8,0],[0,0,0,8,8,8,8,8,8],[0,0,0,8,5,8,8,8,8],[0,0,0,8,8,8,8,8,8],[0,0,0,4,8,8,8,8,8],[0,8,0,0,8,8,8,8,0],[8,8,7,7,7,7,7,7,0],[0,0,0,0,7,7,7,7,0],[0,0,0,0,7,7,7,7,0],[0,0,0,0,7,7,7,7,0],[0,0,0,0,7,0,0,7,0],[0,0,0,8,8,0,8,8,0]],right:[[0,8,8,8,8,0,0,0,0],[8,8,8,8,8,8,0,0,0],[8,8,8,8,5,8,0,0,0],[8,8,8,8,8,8,0,0,0],[8,8,8,8,8,4,0,0,0],[0,8,8,8,8,0,0,8,0],[0,7,7,7,7,7,7,8,8],[0,7,7,7,7,0,0,0,0],[0,7,7,7,7,0,0,0,0],[0,7,7,7,7,0,0,0,0],[0,7,0,0,7,0,0,0,0],[0,8,8,0,8,8,0,0,0]]},blob:{left:[[0,0,0,8,8,8,8,0,0,0],[0,0,8,8,8,8,8,8,0,0],[0,5,5,8,8,8,8,8,0,0],[0,8,8,8,8,8,8,8,8,0],[0,8,8,8,8,8,8,8,8,0],[8,8,8,8,8,8,8,8,8,8]],right:[[0,0,0,8,8,8,8,0,0,0],[0,0,8,8,8,8,8,8,0,0],[0,8,8,8,8,8,5,5,0,0],[0,8,8,8,8,8,8,8,8,0],[8,8,8,8,8,8,8,8,8,0],[8,8,8,8,8,8,8,8,8,8]]},muzz:[[0,8,0,0,5,5,8,5,5,0,0,8,0],[8,7,8,0,5,4,8,4,5,0,8,7,8],[0,0,7,8,8,8,5,8,8,8,7,0,0],[0,0,0,7,8,5,8,5,8,7,0,0,0],[0,0,0,0,8,5,8,5,8,0,0,0,0]]},bullet:{bullet:["3","3"],explode:{left:[],right:[]}},cloud:[[0,0,6,6,6,6,6,6,6,0,0],[0,6,6,6,6,6,6,6,6,6,0],[6,6,6,6,6,6,6,6,6,6,6],[0,6,6,6,6,6,6,6,6,6,0],[0,0,6,6,6,6,6,6,6,0,0]]},hero={x:cWidth/2-scale*sprites.hero.left[0].length/2,y:cHeight-(sprites.hero.left.length*scale+scale*2),life:5,jump:0,height:0,speed:0,dir:rand(0,1)?"right":"left",hit:0,crouch:0},enemys.push(new enemy,new enemy,new enemy),clouds.push(new cloud),setInterval(function(){rand(0,spawnChange)?"":enemys.push(new enemy),rand(0,spawnChange)?"":clouds.length<21?clouds.push(new cloud):""},1e3),setInterval(loop,50)